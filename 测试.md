# 测试

## 单元测试

由于缺乏真实的数据库环境，我们对每个生成的 BQL 查询语句逐一进行逻辑检查，以确保输出基本符合预期。

### 测试结果解释和示例

#### `result.json` 的内容：

- **描述**: 包含 BQL语句 查询的生成结果，其中每个结果有唯一编号 (`Index`)、相关的 `BeID` 和生成的 BQL 语句。
- **示例数据**:

| Index | BeID                                                         | BQL                                                          |
| ----- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1     | ["0029c056-484c-450f-8ce0-e85528ea7f51"]                     | SELECT SaleOrder.OrderCode, SaleOrder.TotalPrice, SaleOrder.PayMethod FROM SaleOrder.SaleOrder |
| 2     | ["07519aa2-4170-4949-9353-8e08709d21da", "e6cbbb12-3964-4bc8-90a2-8d07d3d99852"] | SELECT SaleOrder.OrderCode FROM SaleOrder.SaleOrder LEFT JOIN Customer.Customer ON SaleOrder.Customer = Customer.ID WHERE Customer.Credit_Code = 'A' |

#### `result_withNL.json` 的内容：

- **描述**: 包含原始自然语言查询、原始的 BQL 语句及生成的 BQL 语句，方便对比查看。
- **说明**：可以直接在`result_withNL.json` 文件中，搜索关键字"不匹配"，查看有差异的例子
- **示例数据**:

| 自然语言查询                                   | BeID                                     | 原始 BQL 语句                                                | 生成的 BQL 语句                                              | 匹配结果 |
| ---------------------------------------------- | ---------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
| 查询所有销售订单的订单编号、订单金额、支付方式 | ["0029c056-484c-450f-8ce0-e85528ea7f51"] | SELECT SaleOrder.OrderCode, SaleOrder.TotalPrice, SaleOrder.PayMethod FROM SaleOrder.SaleOrder | SELECT SaleOrder.OrderCode, SaleOrder.TotalPrice, SaleOrder.PayMethod FROM SaleOrder.SaleOrder | 完全匹配 |
| 查询2024年共有多少条销售订单                   | ["0029c056-484c-450f-8ce0-e85528ea7f51"] | SELECT COUNT(1) as count FROM SaleOrder.SaleOrder WHERE YEAR(SaleOrder.OrderTime) = '2024' | SELECT COUNT(1) as OrderCount FROM SaleOrder.SaleOrder WHERE YEAR(SaleOrder.OrderTime) = '2024' | 不匹配   |

同时，在单元测试中，我们加入了边界条件测试，包括空字符串输入、特殊字符等情况，以确保程序运行的鲁棒性。下面的表格为我们所做的单元测试。

| 自然语言       | 系统输出                                                     |
| -------------- | ------------------------------------------------------------ |
| ""             | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| " "            | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| "1"            | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| "!"            | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| "@"            | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| ")"            | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| "……"           | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| "!!!!@@@@####" | 十分抱歉,您的查询请求未通过安全审查,原因: 请提供您需要审核的自然语言查询请求，以便我进行... |
| "a"            | 十分抱歉,您的查询请求未通过安全审查,原因: 非查询内容         |
| "aaa"          | 十分抱歉,您的查询请求未通过安全审查,原因: 非查询内容         |
| "I love you"   | 十分抱歉,您的查询请求未通过安全审查,原因: 非查询内容         |
| "ok"           | 十分抱歉,您的查询请求未通过安全审查,原因: 非查询内容         |
| "你好"         | 十分抱歉,您的查询请求未通过安全审查,原因: 非查询内容         |
| "你知道吗"     | 十分抱歉,您的查询请求未通过安全审查,原因: 非查询内容         |
| "盾壳vs蛋肯"   | 十分抱歉,您的查询请求未通过安全审查,原因: 非查询内容         |

------

## 集成测试

这部分涵盖了完整的流程测试，旨在验证从输入到输出的整个查询生成流程，确保各组件能够协同工作。

以下是集成测试的具体内容：

| 编号 | 用例名称         | 测试背景                             | 优先级 | 重要级 | 测试数据                                     | 测试步骤                                                     | 预期结果                         | 实际结果 |
| ---- | ---------------- | ------------------------------------ | ------ | ------ | -------------------------------------------- | ------------------------------------------------------------ | -------------------------------- | -------- |
| 1    | 测试大模型生成   | 无                                   | 1      | 1      | 内容：你是一个私人助手，可以回答我一些问题吗 | 运行 python 脚本，将 prompt 输入给指定 url 的大模型，等待其返回结果 | 大模型返回对测试数据的回答       | 正常回答 |
| 2    | 测试安全检查     | 大模型可以正常生成                   | 2      | 2      | 使用边界条件                                 | 将边界条件数据和安全检查 prompt 融合输入给大模型，得到检查结果 | 拒绝不合理查询，接受合理查询     | 正常回答 |
| 3    | 测试整体框架     | 基础部分正常                         | 2      | 2      | NaN                                          | 运行 python 主程序                                           | 正常运行                         | 正常运行 |
| 4    | 测试批量生成     | 整体框架可以正常运行，大模型生成正常 | 2      | 2      | 测试集文件                                   | 修改文件路径，运行主程序，输入 1，等待结果                   | 正常运行得到结果并保存到文件中   | 正常运行 |
| 5    | 测试命令行生成   | 整体框架可以正常运行，大模型生成正常 | 2      | 2      | 随机选择测试集中的数据                       | 运行主程序，输入 2，输入查询，等待结果                       | 正常运行得到结果并输出到终端窗口 | 正常运行 |
| 6    | 测试 gradio 方式 | 整体框架可以正常运行，大模型生成正常 | 2      | 2      | 随机选择测试集中的数据                       | 运行主程序，输入 3，打开本地浏览器，输入 url 和端口，输入查询，等待结果返回 | 正常运行得到结果并输出到网页窗口 | 正常运行 |
| 7    | 测试退出         | 框架正常运行                         | 3      | 3      | NaN                                          | 启动主程序，随机选择模式运行，运行过程中输入 4               | 进程退出，终端出现命令提示符     | 正常退出 |

------

## 系统测试

该部分内容与项目中的集成测试重合，故省略。